<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Juan Li">
<meta name="dcterms.date" content="2025-09-11">

<title>Centered algorithms using real data - Linear regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="1.5 real_data_example_linear_regression_files/libs/clipboard/clipboard.min.js"></script>
<script src="1.5 real_data_example_linear_regression_files/libs/quarto-html/quarto.js"></script>
<script src="1.5 real_data_example_linear_regression_files/libs/quarto-html/popper.min.js"></script>
<script src="1.5 real_data_example_linear_regression_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="1.5 real_data_example_linear_regression_files/libs/quarto-html/anchor.min.js"></script>
<link href="1.5 real_data_example_linear_regression_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="1.5 real_data_example_linear_regression_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="1.5 real_data_example_linear_regression_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="1.5 real_data_example_linear_regression_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="1.5 real_data_example_linear_regression_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="1.5 real_data_example_linear_regression_files/libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="1.5 real_data_example_linear_regression_files/libs/tabwid-1.1.3/tabwid.js"></script>


<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#dataset-california-housing-prices" id="toc-dataset-california-housing-prices" class="nav-link active" data-scroll-target="#dataset-california-housing-prices">Dataset: California Housing Prices</a>
  <ul class="collapse">
  <li><a href="#some-data-cleaning" id="toc-some-data-cleaning" class="nav-link" data-scroll-target="#some-data-cleaning">Some data cleaning</a></li>
  <li><a href="#data-sampling" id="toc-data-sampling" class="nav-link" data-scroll-target="#data-sampling">Data sampling</a></li>
  </ul></li>
  <li><a href="#data-visualization" id="toc-data-visualization" class="nav-link" data-scroll-target="#data-visualization">Data visualization</a>
  <ul class="collapse">
  <li><a href="#rcs-of-longitude-and-latitude" id="toc-rcs-of-longitude-and-latitude" class="nav-link" data-scroll-target="#rcs-of-longitude-and-latitude">rcs of <code>longitude</code> and <code>latitude</code></a></li>
  </ul></li>
  <li><a href="#original-and-centered-models-using-the-train-dataset" id="toc-original-and-centered-models-using-the-train-dataset" class="nav-link" data-scroll-target="#original-and-centered-models-using-the-train-dataset">Original and centered models using the <code>train</code> dataset</a></li>
  <li><a href="#further-sampling" id="toc-further-sampling" class="nav-link" data-scroll-target="#further-sampling">Further sampling</a></li>
  <li><a href="#apply-the-models-on-the-cheaper-houses-test_cheap-dataset" id="toc-apply-the-models-on-the-cheaper-houses-test_cheap-dataset" class="nav-link" data-scroll-target="#apply-the-models-on-the-cheaper-houses-test_cheap-dataset">Apply the models on the cheaper houses: <code>test_cheap</code> dataset</a>
  <ul class="collapse">
  <li><a href="#some-calibration-plots-on-the-test_cheap-dataset" id="toc-some-calibration-plots-on-the-test_cheap-dataset" class="nav-link" data-scroll-target="#some-calibration-plots-on-the-test_cheap-dataset">Some calibration plots on the test_cheap dataset</a></li>
  </ul></li>
  <li><a href="#apply-the-models-on-the-more-expensive-houses-test_expensive-dataset" id="toc-apply-the-models-on-the-more-expensive-houses-test_expensive-dataset" class="nav-link" data-scroll-target="#apply-the-models-on-the-more-expensive-houses-test_expensive-dataset">Apply the models on the more expensive houses: <code>test_expensive</code> dataset</a>
  <ul class="collapse">
  <li><a href="#some-calibration-plots-on-the-test_expensive-dataset" id="toc-some-calibration-plots-on-the-test_expensive-dataset" class="nav-link" data-scroll-target="#some-calibration-plots-on-the-test_expensive-dataset">Some calibration plots on the test_expensive dataset</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Centered algorithms using real data - Linear regression</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Juan Li </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 11, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># Data manipulation</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr) <span class="co"># Tidy messy data</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># Data visualization</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr) <span class="co"># ggarrange</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fastDummies) <span class="co"># make dummy variables</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/util.R"</span>) </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># functions in "util.R"</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># get_rcs: implement the formula of rcs components</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># step_dummy: dummy variables</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># step_rcs: rcs</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># step_interaction: interaction terms</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># step_center: centering</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># get_mean: get mean values from the original dataset</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># root.search: Root searching, not in use in this .qmd file</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/calibration.R"</span>) <span class="co"># for calibration plots</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="dataset-california-housing-prices" class="level1">
<h1>Dataset: California Housing Prices</h1>
<p>We will use the <a href="https://www.kaggle.com/datasets/camnugent/california-housing-prices">California Housing Prices</a> dataset for the examples.</p>
<p>About this file</p>
<ol type="1">
<li><p><code>longitude</code>: A measure of how far west a house is; a higher value is farther west</p></li>
<li><p><code>latitude</code>: A measure of how far north a house is; a higher value is farther north</p></li>
<li><p><code>housing_median_age</code>: Median age of a house within a block; a lower number is a newer building</p></li>
<li><p><code>total_rooms</code>: Total number of rooms within a block</p></li>
<li><p><code>total_bedrooms</code>: Total number of bedrooms within a block</p></li>
<li><p><code>population</code>: Total number of people residing within a block</p></li>
<li><p><code>households</code>: Total number of households, a group of people residing within a home unit, for a block</p></li>
<li><p><code>median_income</code>: Median income for households within a block of houses (measured in tens of thousands of US Dollars)</p></li>
<li><p><strong>Outcome</strong>: <code>median_house_value</code>: Median house value for households within a block (measured in US Dollars).</p></li>
<li><p><code>ocean_proximity</code>: Location of the house w.r.t ocean/sea</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/housing.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20640    10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># there is only a few observations with missing data, for simplicity, remove `NA`s</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data[<span class="fu">complete.cases</span>(data), ]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20433    10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   longitude         latitude     housing_median_age  total_rooms   
 Min.   :-124.3   Min.   :32.54   Min.   : 1.00      Min.   :    2  
 1st Qu.:-121.8   1st Qu.:33.93   1st Qu.:18.00      1st Qu.: 1450  
 Median :-118.5   Median :34.26   Median :29.00      Median : 2127  
 Mean   :-119.6   Mean   :35.63   Mean   :28.63      Mean   : 2637  
 3rd Qu.:-118.0   3rd Qu.:37.72   3rd Qu.:37.00      3rd Qu.: 3143  
 Max.   :-114.3   Max.   :41.95   Max.   :52.00      Max.   :39320  
 total_bedrooms     population      households     median_income    
 Min.   :   1.0   Min.   :    3   Min.   :   1.0   Min.   : 0.4999  
 1st Qu.: 296.0   1st Qu.:  787   1st Qu.: 280.0   1st Qu.: 2.5637  
 Median : 435.0   Median : 1166   Median : 409.0   Median : 3.5365  
 Mean   : 537.9   Mean   : 1425   Mean   : 499.4   Mean   : 3.8712  
 3rd Qu.: 647.0   3rd Qu.: 1722   3rd Qu.: 604.0   3rd Qu.: 4.7440  
 Max.   :6445.0   Max.   :35682   Max.   :6082.0   Max.   :15.0001  
 median_house_value   ocean_proximity
 Min.   : 14999     &lt;1H OCEAN :9034  
 1st Qu.:119500     INLAND    :6496  
 Median :179700     ISLAND    :   5  
 Mean   :206864     NEAR BAY  :2270  
 3rd Qu.:264700     NEAR OCEAN:2628  
 Max.   :500001                      </code></pre>
</div>
</div>
<section id="some-data-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="some-data-cleaning">Some data cleaning</h2>
<p>There are only 5 observation where <code>ocean_proximity == ISLAND</code>. Remove this in the analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ocean_proximity <span class="sc">!=</span> <span class="st">"ISLAND"</span>) <span class="sc">%&gt;%</span> <span class="fu">droplevels</span>()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20428    10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   longitude         latitude     housing_median_age  total_rooms   
 Min.   :-124.3   Min.   :32.54   Min.   : 1.00      Min.   :    2  
 1st Qu.:-121.8   1st Qu.:33.93   1st Qu.:18.00      1st Qu.: 1450  
 Median :-118.5   Median :34.26   Median :29.00      Median : 2127  
 Mean   :-119.6   Mean   :35.63   Mean   :28.63      Mean   : 2637  
 3rd Qu.:-118.0   3rd Qu.:37.72   3rd Qu.:37.00      3rd Qu.: 3143  
 Max.   :-114.3   Max.   :41.95   Max.   :52.00      Max.   :39320  
 total_bedrooms     population      households     median_income    
 Min.   :   1.0   Min.   :    3   Min.   :   1.0   Min.   : 0.4999  
 1st Qu.: 296.0   1st Qu.:  788   1st Qu.: 280.0   1st Qu.: 2.5634  
 Median : 435.0   Median : 1166   Median : 409.0   Median : 3.5375  
 Mean   : 537.9   Mean   : 1425   Mean   : 499.5   Mean   : 3.8714  
 3rd Qu.: 647.0   3rd Qu.: 1723   3rd Qu.: 604.0   3rd Qu.: 4.7441  
 Max.   :6445.0   Max.   :35682   Max.   :6082.0   Max.   :15.0001  
 median_house_value   ocean_proximity
 Min.   : 14999     &lt;1H OCEAN :9034  
 1st Qu.:119475     INLAND    :6496  
 Median :179700     NEAR BAY  :2270  
 Mean   :206822     NEAR OCEAN:2628  
 3rd Qu.:264700                      
 Max.   :500001                      </code></pre>
</div>
</div>
<p>Remove the space in <code>ocean_proximity</code> levels to avoid some syntax issue later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(data<span class="sc">$</span>ocean_proximity) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, <span class="fu">levels</span>(data<span class="sc">$</span>ocean_proximity))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20428    10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   longitude         latitude     housing_median_age  total_rooms   
 Min.   :-124.3   Min.   :32.54   Min.   : 1.00      Min.   :    2  
 1st Qu.:-121.8   1st Qu.:33.93   1st Qu.:18.00      1st Qu.: 1450  
 Median :-118.5   Median :34.26   Median :29.00      Median : 2127  
 Mean   :-119.6   Mean   :35.63   Mean   :28.63      Mean   : 2637  
 3rd Qu.:-118.0   3rd Qu.:37.72   3rd Qu.:37.00      3rd Qu.: 3143  
 Max.   :-114.3   Max.   :41.95   Max.   :52.00      Max.   :39320  
 total_bedrooms     population      households     median_income    
 Min.   :   1.0   Min.   :    3   Min.   :   1.0   Min.   : 0.4999  
 1st Qu.: 296.0   1st Qu.:  788   1st Qu.: 280.0   1st Qu.: 2.5634  
 Median : 435.0   Median : 1166   Median : 409.0   Median : 3.5375  
 Mean   : 537.9   Mean   : 1425   Mean   : 499.5   Mean   : 3.8714  
 3rd Qu.: 647.0   3rd Qu.: 1723   3rd Qu.: 604.0   3rd Qu.: 4.7441  
 Max.   :6445.0   Max.   :35682   Max.   :6082.0   Max.   :15.0001  
 median_house_value   ocean_proximity
 Min.   : 14999     &lt;1H_OCEAN :9034  
 1st Qu.:119475     INLAND    :6496  
 Median :179700     NEAR_BAY  :2270  
 Mean   :206822     NEAR_OCEAN:2628  
 3rd Qu.:264700                      
 Max.   :500001                      </code></pre>
</div>
</div>
<p>Histograms of each continuous variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>dflong <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(data, <span class="sc">-</span>ocean_proximity, <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dflong, <span class="fu">aes</span>(value)) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales =</span> <span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of each continuous variable"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1.5-real_data_example_linear_regression_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notice the capping (ceiling effect) of <code>housing_median_age</code> and <code>median_house_value</code>. Crop the data for a simpler example, also because we have a huge dataset to work with.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    median_house_value <span class="sc">&lt;</span> <span class="fu">max</span>(data<span class="sc">$</span>median_house_value),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    housing_median_age <span class="sc">&lt;</span> <span class="fu">max</span>(data<span class="sc">$</span>housing_median_age))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>dflong <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(data, <span class="sc">-</span>ocean_proximity, <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dflong, <span class="fu">aes</span>(value)) <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales =</span> <span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of each continuous variable"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1.5-real_data_example_linear_regression_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   longitude         latitude     housing_median_age  total_rooms   
 Min.   :-124.3   Min.   :32.54   Min.   : 1.00      Min.   :    2  
 1st Qu.:-121.5   1st Qu.:33.92   1st Qu.:17.00      1st Qu.: 1458  
 Median :-118.5   Median :34.24   Median :27.00      Median : 2142  
 Mean   :-119.5   Mean   :35.59   Mean   :26.97      Mean   : 2670  
 3rd Qu.:-118.0   3rd Qu.:37.67   3rd Qu.:36.00      3rd Qu.: 3182  
 Max.   :-114.3   Max.   :41.95   Max.   :51.00      Max.   :39320  
 total_bedrooms   population      households     median_income    
 Min.   :   2   Min.   :    3   Min.   :   2.0   Min.   : 0.4999  
 1st Qu.: 300   1st Qu.:  811   1st Qu.: 284.0   1st Qu.: 2.5370  
 Median : 442   Median : 1203   Median : 416.0   Median : 3.4706  
 Mean   : 548   Mean   : 1470   Mean   : 508.6   Mean   : 3.6938  
 3rd Qu.: 659   3rd Qu.: 1779   3rd Qu.: 614.0   3rd Qu.: 4.6167  
 Max.   :6445   Max.   :35682   Max.   :6082.0   Max.   :15.0001  
 median_house_value   ocean_proximity
 Min.   : 14999     &lt;1H_OCEAN :8235  
 1st Qu.:115400     INLAND    :6290  
 Median :171200     NEAR_BAY  :1549  
 Mean   :189544     NEAR_OCEAN:2303  
 3rd Qu.:243200                      
 Max.   :500000                      </code></pre>
</div>
</div>
</section>
<section id="data-sampling" class="level2">
<h2 class="anchored" data-anchor-id="data-sampling">Data sampling</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># random split the data into trian/test = 0.7/0.3</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">101</span>) <span class="co"># Set Seed so that same sample can be reproduced in future also</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Now Selecting 75% of data as sample from total 'n' rows of the data  </span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(<span class="at">n =</span> <span class="fu">nrow</span>(data), <span class="at">size =</span> <span class="fu">floor</span>(.<span class="dv">7</span><span class="sc">*</span><span class="fu">nrow</span>(data)), <span class="at">replace =</span> F)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">""</span>, <span class="fu">nrow</span>(data))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>vec[sample] <span class="ot">&lt;-</span> <span class="st">"train"</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>vec[<span class="sc">-</span>sample] <span class="ot">&lt;-</span> <span class="st">"test"</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>type <span class="ot">&lt;-</span> vec</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>type, <span class="at">levels=</span> <span class="fu">c</span>(<span class="st">"train"</span>, <span class="st">"test"</span>))</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"train"</span>) </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"test"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For a large dataset like the California Housing Prices, the distributions of each variable in train and test datasets, including the outcome, can be very close by random sampling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_summary</span>(<span class="at">by =</span> <span class="st">"type"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modify_header</span>(<span class="at">label =</span> <span class="st">"**Variable**"</span>) <span class="sc">%&gt;%</span> <span class="co"># update the column header</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modify_caption</span>(<span class="st">"Table 1. Summary of the two datasets"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bold_labels</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_flex_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-a6b1699e{}.cl-a6ae3d1e{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a6ae3d28{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a6ae3d29{font-family:'Helvetica';font-size:6.6pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;position: relative;bottom:3.3pt;}.cl-a6af85f2{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2pt;padding-top:2pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a6af85f3{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2pt;padding-top:2pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a6af85fc{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a6af85fd{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a6af85fe{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:15pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a6af85ff{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a6af9538{width:1.746in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6af9539{width:2.171in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6af953a{width:1.746in;background-color:transparent;vertical-align: top;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6af953b{width:2.171in;background-color:transparent;vertical-align: top;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6af9542{width:1.746in;background-color:transparent;vertical-align: top;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6af9543{width:2.171in;background-color:transparent;vertical-align: top;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6af9544{width:1.746in;background-color:transparent;vertical-align: top;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6af954c{width:2.171in;background-color:transparent;vertical-align: top;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6af954d{width:1.746in;background-color:transparent;vertical-align: top;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6af954e{width:2.171in;background-color:transparent;vertical-align: top;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6af954f{width:1.746in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6af9550{width:2.171in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-a6b1699e"><thead><tr style="overflow-wrap:break-word;"><th class="cl-a6af9538"><p class="cl-a6af85f2"><span class="cl-a6ae3d1e">Variable</span></p></th><th class="cl-a6af9539"><p class="cl-a6af85f3"><span class="cl-a6ae3d1e">train</span><span class="cl-a6ae3d28">  </span><br><span class="cl-a6ae3d28">N = 12,863</span><span class="cl-a6ae3d29">1</span></p></th><th class="cl-a6af9539"><p class="cl-a6af85f3"><span class="cl-a6ae3d1e">test</span><span class="cl-a6ae3d28">  </span><br><span class="cl-a6ae3d28">N = 5,514</span><span class="cl-a6ae3d29">1</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-a6af953a"><p class="cl-a6af85fc"><span class="cl-a6ae3d1e">longitude</span></p></td><td class="cl-a6af953b"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">-118.45 (-121.56, -117.97)</span></p></td><td class="cl-a6af953b"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">-118.45 (-121.53, -117.97)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a6af9542"><p class="cl-a6af85fc"><span class="cl-a6ae3d1e">latitude</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">34.24 (33.92, 37.67)</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">34.24 (33.92, 37.67)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a6af953a"><p class="cl-a6af85fc"><span class="cl-a6ae3d1e">housing_median_age</span></p></td><td class="cl-a6af953b"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">27 (17, 36)</span></p></td><td class="cl-a6af953b"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">27 (18, 36)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a6af9542"><p class="cl-a6af85fc"><span class="cl-a6ae3d1e">total_rooms</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">2,155 (1,465, 3,184)</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">2,114 (1,439, 3,174)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a6af9542"><p class="cl-a6af85fc"><span class="cl-a6ae3d1e">total_bedrooms</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">443 (303, 659)</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">438 (295, 659)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a6af9542"><p class="cl-a6af85fc"><span class="cl-a6ae3d1e">population</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">1,203 (812, 1,782)</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">1,202 (809, 1,769)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a6af9542"><p class="cl-a6af85fc"><span class="cl-a6ae3d1e">households</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">417 (285, 615)</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">412 (282, 611)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a6af9542"><p class="cl-a6af85fc"><span class="cl-a6ae3d1e">median_income</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">3.49 (2.55, 4.63)</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">3.42 (2.51, 4.60)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a6af9542"><p class="cl-a6af85fc"><span class="cl-a6ae3d1e">median_house_value</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">171,900 (115,900, 244,200)</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">169,500 (114,000, 240,800)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a6af9544"><p class="cl-a6af85fc"><span class="cl-a6ae3d1e">ocean_proximity</span></p></td><td class="cl-a6af954c"><p class="cl-a6af85fd"><span class="cl-a6ae3d28"></span></p></td><td class="cl-a6af954c"><p class="cl-a6af85fd"><span class="cl-a6ae3d28"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a6af9542"><p class="cl-a6af85fe"><span class="cl-a6ae3d28">&lt;1H_OCEAN</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">5,763 (45%)</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">2,472 (45%)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a6af9542"><p class="cl-a6af85fe"><span class="cl-a6ae3d28">INLAND</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">4,390 (34%)</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">1,900 (34%)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a6af9542"><p class="cl-a6af85fe"><span class="cl-a6ae3d28">NEAR_BAY</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">1,101 (8.6%)</span></p></td><td class="cl-a6af9543"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">448 (8.1%)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-a6af954d"><p class="cl-a6af85fe"><span class="cl-a6ae3d28">NEAR_OCEAN</span></p></td><td class="cl-a6af954e"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">1,609 (13%)</span></p></td><td class="cl-a6af954e"><p class="cl-a6af85fd"><span class="cl-a6ae3d28">694 (13%)</span></p></td></tr></tbody><tfoot><tr style="overflow-wrap:break-word;"><td colspan="3" class="cl-a6af954f"><p class="cl-a6af85ff"><span class="cl-a6ae3d29">1</span><span class="cl-a6ae3d28">Median (Q1, Q3); n (%)</span></p></td></tr></tfoot></table></div>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>type)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-visualization" class="level1">
<h1>Data visualization</h1>
<p>Below visualize the relationship between <code>median_house_value</code> and other continuous variables in the <code>train</code> dataset. <em>Note:</em> Because of the large sample size, the data points are omited, only the fitted lines are shown. The thicker black lines are for the overall relationship.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pivot the data longer to plot in facets</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>dflong <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(train, <span class="sc">-</span><span class="fu">c</span>(median_house_value, ocean_proximity), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dflong, <span class="fu">aes</span>(value, median_house_value, <span class="at">color =</span> ocean_proximity)) <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">group =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">2</span>, <span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> <span class="st">'y ~ x'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> <span class="st">'y ~ x'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales =</span> <span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Figure 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1.5-real_data_example_linear_regression_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dflong, <span class="fu">aes</span>(value, median_house_value, <span class="at">color =</span> ocean_proximity)) <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(alpha = 0.2) +</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">group =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">2</span>, <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y ~ x'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y ~ x'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales =</span> <span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Figure 2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1.5-real_data_example_linear_regression_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From <strong>Figures 1,2</strong>, it appears that</p>
<ol type="1">
<li><p><code>longitude</code> and <code>latitude</code> should be nonlinear terms</p></li>
<li><p>Should consider the interaction between <code>ocean_proximity</code> with <code>households</code>, <code>housing_median_age</code>, <code>latitude</code>, <code>longitude</code>, <code>population</code>, <code>total_bedrooms</code>, <code>total_rooms</code></p></li>
</ol>
<p><strong>Note:</strong> this is just a visual inspection to create an example, more tests may be required if working on a real project.</p>
<section id="rcs-of-longitude-and-latitude" class="level2">
<h2 class="anchored" data-anchor-id="rcs-of-longitude-and-latitude">rcs of <code>longitude</code> and <code>latitude</code></h2>
<p>Explore the number of knots. From the figure below, Ill use <code>rcs(longitude, 5)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># longitude</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train, <span class="fu">aes</span>(longitude, median_house_value)) <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> <span class="st">'y ~ x'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Loess Smooth"</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train, <span class="fu">aes</span>(longitude, median_house_value)) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y ~ rcs(x,3)'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"RCS, 3 knots"</span>) <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train, <span class="fu">aes</span>(longitude, median_house_value)) <span class="sc">+</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y ~ rcs(x,4)'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"RCS, 4 knots"</span>) <span class="sc">+</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train, <span class="fu">aes</span>(longitude, median_house_value)) <span class="sc">+</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y ~ rcs(x,5)'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"RCS, 5 knots"</span>) <span class="sc">+</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train, <span class="fu">aes</span>(longitude, median_house_value)) <span class="sc">+</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y ~ rcs(x,6)'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"RCS, 6 knots"</span>) <span class="sc">+</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="st">  123</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="st">  45#</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4 <span class="sc">+</span> p5 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design =</span> design)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1.5-real_data_example_linear_regression_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the figure below, Ill use <code>rcs(latitude, 4)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># latitude</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train, <span class="fu">aes</span>(latitude, median_house_value)) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">formula =</span> <span class="st">'y ~ x'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Loess Smooth"</span>) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train, <span class="fu">aes</span>(latitude, median_house_value)) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y ~ rcs(x,3)'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"RCS, 3 knots"</span>) <span class="sc">+</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train, <span class="fu">aes</span>(latitude, median_house_value)) <span class="sc">+</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y ~ rcs(x,4)'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"RCS, 4 knots"</span>) <span class="sc">+</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train, <span class="fu">aes</span>(latitude, median_house_value)) <span class="sc">+</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y ~ rcs(x,5)'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"RCS, 5 knots"</span>) <span class="sc">+</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train, <span class="fu">aes</span>(latitude, median_house_value)) <span class="sc">+</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">'y ~ rcs(x,6)'</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"RCS, 6 knots"</span>) <span class="sc">+</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="st">  123</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="st">  45#</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4 <span class="sc">+</span> p5 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design =</span> design)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1.5-real_data_example_linear_regression_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="original-and-centered-models-using-the-train-dataset" class="level1">
<h1>Original and centered models using the <code>train</code> dataset</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The original model</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>fit.o <span class="ot">&lt;-</span> <span class="fu">lm</span>(median_house_value <span class="sc">~</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  ocean_proximity <span class="sc">*</span> <span class="fu">rcs</span>(longitude, <span class="dv">5</span>)  <span class="sc">+</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  ocean_proximity <span class="sc">*</span> <span class="fu">rcs</span>(latitude, <span class="dv">4</span>)  <span class="sc">+</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  ocean_proximity <span class="sc">*</span> housing_median_age  <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  ocean_proximity <span class="sc">*</span> total_rooms  <span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  ocean_proximity <span class="sc">*</span> total_bedrooms  <span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  ocean_proximity <span class="sc">*</span> population  <span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  ocean_proximity <span class="sc">*</span> households  <span class="sc">+</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  median_income, <span class="at">data =</span> train)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.o)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = median_house_value ~ ocean_proximity * rcs(longitude, 
    5) + ocean_proximity * rcs(latitude, 4) + ocean_proximity * 
    housing_median_age + ocean_proximity * total_rooms + ocean_proximity * 
    total_bedrooms + ocean_proximity * population + ocean_proximity * 
    households + median_income, data = train)

Residuals:
    Min      1Q  Median      3Q     Max 
-348129  -32266   -7435   23286  351079 

Coefficients: (3 not defined because of singularities)
                                                             Estimate
(Intercept)                                             -3156567.7503
ocean_proximityINLAND                                    6049451.1117
ocean_proximityNEAR_BAY                                 27089450.3403
ocean_proximityNEAR_OCEAN                               24414616.4757
rcs(longitude, 5)longitude                                -39385.4303
rcs(longitude, 5)longitude'                               385009.8599
rcs(longitude, 5)longitude''                             -749579.2231
rcs(longitude, 5)longitude'''                            2341732.4863
rcs(latitude, 4)latitude                                  -47826.8041
rcs(latitude, 4)latitude'                                 314521.8591
rcs(latitude, 4)latitude''                               -568775.1671
housing_median_age                                           119.0785
total_rooms                                                   -0.2443
total_bedrooms                                                13.1733
population                                                   -43.3010
households                                                   119.8116
median_income                                              33714.4330
ocean_proximityINLAND:rcs(longitude, 5)longitude           44757.1070
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude       -403223.2588
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude      171503.3067
ocean_proximityINLAND:rcs(longitude, 5)longitude'        -518103.3524
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude'     35757982.3082
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude'    -805173.6720
ocean_proximityINLAND:rcs(longitude, 5)longitude''       1002237.8679
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude''               NA
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude''   1407107.9584
ocean_proximityINLAND:rcs(longitude, 5)longitude'''     -4012726.8612
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude'''              NA
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude''' -8868898.2621
ocean_proximityINLAND:rcs(latitude, 4)latitude            -15039.6192
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude        -2115580.0052
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude       -104301.1329
ocean_proximityINLAND:rcs(latitude, 4)latitude'          -184078.3428
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude'        1122496.5142
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude'       417192.2210
ocean_proximityINLAND:rcs(latitude, 4)latitude''          386959.3006
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude''                 NA
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude''     -567362.1937
ocean_proximityINLAND:housing_median_age                     -82.1755
ocean_proximityNEAR_BAY:housing_median_age                    96.8684
ocean_proximityNEAR_OCEAN:housing_median_age                 592.0972
ocean_proximityINLAND:total_rooms                             -1.4762
ocean_proximityNEAR_BAY:total_rooms                           15.2769
ocean_proximityNEAR_OCEAN:total_rooms                         12.1418
ocean_proximityINLAND:total_bedrooms                          48.6847
ocean_proximityNEAR_BAY:total_bedrooms                      -106.9013
ocean_proximityNEAR_OCEAN:total_bedrooms                     110.0786
ocean_proximityINLAND:population                              26.1814
ocean_proximityNEAR_BAY:population                           -20.5255
ocean_proximityNEAR_OCEAN:population                           7.7182
ocean_proximityINLAND:households                            -131.9383
ocean_proximityNEAR_BAY:households                            76.4576
ocean_proximityNEAR_OCEAN:households                        -205.6808
                                                           Std. Error t value
(Intercept)                                              1502387.0331  -2.101
ocean_proximityINLAND                                    1575635.9808   3.839
ocean_proximityNEAR_BAY                                  9875735.8030   2.743
ocean_proximityNEAR_OCEAN                                3084087.3514   7.916
rcs(longitude, 5)longitude                                 11972.9715  -3.290
rcs(longitude, 5)longitude'                                40267.6575   9.561
rcs(longitude, 5)longitude''                               66584.3070 -11.258
rcs(longitude, 5)longitude'''                             272222.3700   8.602
rcs(latitude, 4)latitude                                    8506.2414  -5.623
rcs(latitude, 4)latitude'                                  35550.4715   8.847
rcs(latitude, 4)latitude''                                 56622.5500 -10.045
housing_median_age                                            81.8566   1.455
total_rooms                                                    1.0048  -0.243
total_bedrooms                                                16.3113   0.808
population                                                     1.6904 -25.616
households                                                    18.6519   6.424
median_income                                                443.6533  75.993
ocean_proximityINLAND:rcs(longitude, 5)longitude           12542.4677   3.568
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude         27134.1571 -14.860
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude       24068.7670   7.126
ocean_proximityINLAND:rcs(longitude, 5)longitude'          44414.5543 -11.665
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude'      3862663.0105   9.257
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude'      75828.3622 -10.618
ocean_proximityINLAND:rcs(longitude, 5)longitude''         74013.0611  13.541
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude''               NA      NA
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude''    126715.3261  11.104
ocean_proximityINLAND:rcs(longitude, 5)longitude'''       326390.0788 -12.294
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude'''              NA      NA
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude'''   726161.2407 -12.213
ocean_proximityINLAND:rcs(latitude, 4)latitude             10929.6974  -1.376
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude          267313.8500  -7.914
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude         22629.0269  -4.609
ocean_proximityINLAND:rcs(latitude, 4)latitude'            44914.0651  -4.098
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude'         149909.0888   7.488
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude'        80761.4780   5.166
ocean_proximityINLAND:rcs(latitude, 4)latitude''           71497.1021   5.412
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude''                 NA      NA
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude''      122242.7423  -4.641
ocean_proximityINLAND:housing_median_age                     113.7560  -0.722
ocean_proximityNEAR_BAY:housing_median_age                   184.7460   0.524
ocean_proximityNEAR_OCEAN:housing_median_age                 163.0914   3.630
ocean_proximityINLAND:total_rooms                              1.6593  -0.890
ocean_proximityNEAR_BAY:total_rooms                            2.8866   5.292
ocean_proximityNEAR_OCEAN:total_rooms                          2.2233   5.461
ocean_proximityINLAND:total_bedrooms                          18.4019   2.646
ocean_proximityNEAR_BAY:total_bedrooms                        50.7303  -2.107
ocean_proximityNEAR_OCEAN:total_bedrooms                      30.3476   3.627
ocean_proximityINLAND:population                               2.8416   9.214
ocean_proximityNEAR_BAY:population                             5.4134  -3.792
ocean_proximityNEAR_OCEAN:population                           3.2748   2.357
ocean_proximityINLAND:households                              21.2416  -6.211
ocean_proximityNEAR_BAY:households                            59.0132   1.296
ocean_proximityNEAR_OCEAN:households                          34.9529  -5.885
                                                                    Pr(&gt;|t|)
(Intercept)                                                         0.035657
ocean_proximityINLAND                                               0.000124
ocean_proximityNEAR_BAY                                             0.006096
ocean_proximityNEAR_OCEAN                                0.00000000000000265
rcs(longitude, 5)longitude                                          0.001006
rcs(longitude, 5)longitude'                             &lt; 0.0000000000000002
rcs(longitude, 5)longitude''                            &lt; 0.0000000000000002
rcs(longitude, 5)longitude'''                           &lt; 0.0000000000000002
rcs(latitude, 4)latitude                                 0.00000001920867312
rcs(latitude, 4)latitude'                               &lt; 0.0000000000000002
rcs(latitude, 4)latitude''                              &lt; 0.0000000000000002
housing_median_age                                                  0.145771
total_rooms                                                         0.807897
total_bedrooms                                                      0.419324
population                                              &lt; 0.0000000000000002
households                                               0.00000000013783649
median_income                                           &lt; 0.0000000000000002
ocean_proximityINLAND:rcs(longitude, 5)longitude                    0.000360
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude      &lt; 0.0000000000000002
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude     0.00000000000109210
ocean_proximityINLAND:rcs(longitude, 5)longitude'       &lt; 0.0000000000000002
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude'     &lt; 0.0000000000000002
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude'   &lt; 0.0000000000000002
ocean_proximityINLAND:rcs(longitude, 5)longitude''      &lt; 0.0000000000000002
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude''                      NA
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude''  &lt; 0.0000000000000002
ocean_proximityINLAND:rcs(longitude, 5)longitude'''     &lt; 0.0000000000000002
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude'''                     NA
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude''' &lt; 0.0000000000000002
ocean_proximityINLAND:rcs(latitude, 4)latitude                      0.168836
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude         0.00000000000000269
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude       0.00000408175001177
ocean_proximityINLAND:rcs(latitude, 4)latitude'          0.00004184768903419
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude'        0.00000000000007459
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude'      0.00000024309382034
ocean_proximityINLAND:rcs(latitude, 4)latitude''         0.00000006336256883
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude''                        NA
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude''     0.00000349700211307
ocean_proximityINLAND:housing_median_age                            0.470072
ocean_proximityNEAR_BAY:housing_median_age                          0.600056
ocean_proximityNEAR_OCEAN:housing_median_age                        0.000284
ocean_proximityINLAND:total_rooms                                   0.373683
ocean_proximityNEAR_BAY:total_rooms                      0.00000012279624522
ocean_proximityNEAR_OCEAN:total_rooms                    0.00000004820795128
ocean_proximityINLAND:total_bedrooms                                0.008164
ocean_proximityNEAR_BAY:total_bedrooms                              0.035115
ocean_proximityNEAR_OCEAN:total_bedrooms                            0.000288
ocean_proximityINLAND:population                        &lt; 0.0000000000000002
ocean_proximityNEAR_BAY:population                                  0.000150
ocean_proximityNEAR_OCEAN:population                                0.018445
ocean_proximityINLAND:households                         0.00000000054168536
ocean_proximityNEAR_BAY:households                                  0.195136
ocean_proximityNEAR_OCEAN:households                     0.00000000409209928
                                                           
(Intercept)                                             *  
ocean_proximityINLAND                                   ***
ocean_proximityNEAR_BAY                                 ** 
ocean_proximityNEAR_OCEAN                               ***
rcs(longitude, 5)longitude                              ** 
rcs(longitude, 5)longitude'                             ***
rcs(longitude, 5)longitude''                            ***
rcs(longitude, 5)longitude'''                           ***
rcs(latitude, 4)latitude                                ***
rcs(latitude, 4)latitude'                               ***
rcs(latitude, 4)latitude''                              ***
housing_median_age                                         
total_rooms                                                
total_bedrooms                                             
population                                              ***
households                                              ***
median_income                                           ***
ocean_proximityINLAND:rcs(longitude, 5)longitude        ***
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude      ***
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude    ***
ocean_proximityINLAND:rcs(longitude, 5)longitude'       ***
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude'     ***
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude'   ***
ocean_proximityINLAND:rcs(longitude, 5)longitude''      ***
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude''       
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude''  ***
ocean_proximityINLAND:rcs(longitude, 5)longitude'''     ***
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude'''      
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude''' ***
ocean_proximityINLAND:rcs(latitude, 4)latitude             
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude        ***
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude      ***
ocean_proximityINLAND:rcs(latitude, 4)latitude'         ***
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude'       ***
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude'     ***
ocean_proximityINLAND:rcs(latitude, 4)latitude''        ***
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude''         
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude''    ***
ocean_proximityINLAND:housing_median_age                   
ocean_proximityNEAR_BAY:housing_median_age                 
ocean_proximityNEAR_OCEAN:housing_median_age            ***
ocean_proximityINLAND:total_rooms                          
ocean_proximityNEAR_BAY:total_rooms                     ***
ocean_proximityNEAR_OCEAN:total_rooms                   ***
ocean_proximityINLAND:total_bedrooms                    ** 
ocean_proximityNEAR_BAY:total_bedrooms                  *  
ocean_proximityNEAR_OCEAN:total_bedrooms                ***
ocean_proximityINLAND:population                        ***
ocean_proximityNEAR_BAY:population                      ***
ocean_proximityNEAR_OCEAN:population                    *  
ocean_proximityINLAND:households                        ***
ocean_proximityNEAR_BAY:households                         
ocean_proximityNEAR_OCEAN:households                    ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 54450 on 12813 degrees of freedom
Multiple R-squared:  0.6785,    Adjusted R-squared:  0.6773 
F-statistic: 551.9 on 49 and 12813 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the centered variables and terms</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------- dummy variables --------</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>vars_cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">step_dummy</span>(train, vars_cat)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># -------- rcs --------</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># longitude</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>rcs.fit <span class="ot">&lt;-</span> <span class="fu">rcs</span>(train<span class="sc">$</span>longitude, <span class="dv">5</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>knots_longitude_train <span class="ot">&lt;-</span> <span class="fu">attributes</span>(rcs.fit)<span class="sc">$</span>parms <span class="co"># knot locations</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># latitude</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>rcs.fit <span class="ot">&lt;-</span> <span class="fu">rcs</span>(train<span class="sc">$</span>latitude, <span class="dv">4</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>knots_latitude_train <span class="ot">&lt;-</span> <span class="fu">attributes</span>(rcs.fit)<span class="sc">$</span>parms <span class="co"># knot locations</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># unpack rcs</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>vars_rcs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>knots_list <span class="ot">&lt;-</span> <span class="fu">list</span>(knots_longitude_train, knots_latitude_train)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>knots_list <span class="ot">&lt;-</span> <span class="fu">setNames</span>(knots_list, vars_rcs)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">step_rcs</span>(train, vars_rcs, knots_list)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="co"># -------- interaction terms --------</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>interaction_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"longitude"</span>),</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"housing_median_age"</span>),</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"total_rooms"</span>),</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"total_bedrooms"</span>),</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"population"</span>),</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"households"</span>)</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">step_interaction</span>(train, interaction_list)</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a><span class="co"># -------- centering --------</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>vars_mean <span class="ot">&lt;-</span> <span class="fu">names</span>(train)</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a><span class="co"># get mean values</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>means_train <span class="ot">&lt;-</span> <span class="fu">get_mean</span>(train, vars_mean)</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a><span class="co"># centering vars in the train dataset</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>vars_center <span class="ot">&lt;-</span> <span class="fu">names</span>(means_train)</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">step_center</span>(train, vars_center, means_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The centered model on the trin dataset</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"Mean outcome in the dataset: "</span>, <span class="fu">mean</span>(train<span class="sc">$</span>median_house_value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mean outcome in the dataset: 190162.924512166"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get names of all the centered terms</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">names</span>(train <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"_C"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>median_house_value_C))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># reorganize to get the formula (based on the order in the original model)</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>vec_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  vec[<span class="dv">9</span><span class="sc">:</span><span class="dv">11</span>], <span class="co"># dummy: ocean_proximity</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  vec[<span class="dv">12</span><span class="sc">:</span><span class="dv">18</span>], <span class="co"># rcs(longitude, 5), rcs(latitude, 4)</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  vec[<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>],   <span class="co"># other variables</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  vec[<span class="dv">19</span><span class="sc">:</span><span class="fu">length</span>(vec)] <span class="co"># interaction terms</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"median_house_value ~ "</span>, <span class="fu">paste</span>(vec_names, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>fit.c <span class="ot">&lt;-</span> <span class="fu">lm</span>(formula, <span class="at">data =</span> train)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">coef</span>(fit.o), <span class="fu">coef</span>(fit.c))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                    [,1]
(Intercept)                                             -3156567.7503248
ocean_proximityINLAND                                    6049451.1117313
ocean_proximityNEAR_BAY                                 27089450.3403190
ocean_proximityNEAR_OCEAN                               24414616.4756858
rcs(longitude, 5)longitude                                -39385.4302843
rcs(longitude, 5)longitude'                               385009.8598946
rcs(longitude, 5)longitude''                             -749579.2230573
rcs(longitude, 5)longitude'''                            2341732.4863486
rcs(latitude, 4)latitude                                  -47826.8041439
rcs(latitude, 4)latitude'                                 314521.8591266
rcs(latitude, 4)latitude''                               -568775.1670620
housing_median_age                                           119.0785229
total_rooms                                                   -0.2443199
total_bedrooms                                                13.1733204
population                                                   -43.3009702
households                                                   119.8116464
median_income                                              33714.4330140
ocean_proximityINLAND:rcs(longitude, 5)longitude           44757.1070199
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude       -403223.2587771
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude      171503.3066855
ocean_proximityINLAND:rcs(longitude, 5)longitude'        -518103.3524151
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude'     35757982.3082178
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude'    -805173.6720327
ocean_proximityINLAND:rcs(longitude, 5)longitude''       1002237.8679424
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude''                  NA
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude''   1407107.9583563
ocean_proximityINLAND:rcs(longitude, 5)longitude'''     -4012726.8612470
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude'''                 NA
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude''' -8868898.2621222
ocean_proximityINLAND:rcs(latitude, 4)latitude            -15039.6192312
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude        -2115580.0052054
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude       -104301.1328852
ocean_proximityINLAND:rcs(latitude, 4)latitude'          -184078.3428398
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude'        1122496.5142072
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude'       417192.2209594
ocean_proximityINLAND:rcs(latitude, 4)latitude''          386959.3005964
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude''                    NA
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude''     -567362.1936769
ocean_proximityINLAND:housing_median_age                     -82.1754728
ocean_proximityNEAR_BAY:housing_median_age                    96.8683668
ocean_proximityNEAR_OCEAN:housing_median_age                 592.0972227
ocean_proximityINLAND:total_rooms                             -1.4761759
ocean_proximityNEAR_BAY:total_rooms                           15.2769421
ocean_proximityNEAR_OCEAN:total_rooms                         12.1418385
ocean_proximityINLAND:total_bedrooms                          48.6847225
ocean_proximityNEAR_BAY:total_bedrooms                      -106.9013390
ocean_proximityNEAR_OCEAN:total_bedrooms                     110.0786118
ocean_proximityINLAND:population                              26.1814137
ocean_proximityNEAR_BAY:population                           -20.5255203
ocean_proximityNEAR_OCEAN:population                           7.7181825
ocean_proximityINLAND:households                            -131.9383004
ocean_proximityNEAR_BAY:households                            76.4576031
ocean_proximityNEAR_OCEAN:households                        -205.6808427
                                                                    [,2]
(Intercept)                                               190162.9245108
ocean_proximityINLAND                                    6049451.1120568
ocean_proximityNEAR_BAY                                 27089450.3442241
ocean_proximityNEAR_OCEAN                               24414616.4762743
rcs(longitude, 5)longitude                                -39385.4302869
rcs(longitude, 5)longitude'                               385009.8599022
rcs(longitude, 5)longitude''                             -749579.2230687
rcs(longitude, 5)longitude'''                            2341732.4863652
rcs(latitude, 4)latitude                                  -47826.8041437
rcs(latitude, 4)latitude'                                 314521.8591249
rcs(latitude, 4)latitude''                               -568775.1670608
housing_median_age                                           119.0785229
total_rooms                                                   -0.2443199
total_bedrooms                                                13.1733204
population                                                   -43.3009702
households                                                   119.8116464
median_income                                              33714.4330140
ocean_proximityINLAND:rcs(longitude, 5)longitude           44757.1070225
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude       -403223.2587726
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude      171503.3066901
ocean_proximityINLAND:rcs(longitude, 5)longitude'        -518103.3524228
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude'     35757982.3079216
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude'    -805173.6720455
ocean_proximityINLAND:rcs(longitude, 5)longitude''       1002237.8679539
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude''                  NA
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude''   1407107.9583752
ocean_proximityINLAND:rcs(longitude, 5)longitude'''     -4012726.8612653
ocean_proximityNEAR_BAY:rcs(longitude, 5)longitude'''                 NA
ocean_proximityNEAR_OCEAN:rcs(longitude, 5)longitude''' -8868898.2621635
ocean_proximityINLAND:rcs(latitude, 4)latitude            -15039.6192314
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude        -2115580.0052985
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude       -104301.1328863
ocean_proximityINLAND:rcs(latitude, 4)latitude'          -184078.3428380
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude'        1122496.5142603
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude'       417192.2209664
ocean_proximityINLAND:rcs(latitude, 4)latitude''          386959.3005950
ocean_proximityNEAR_BAY:rcs(latitude, 4)latitude''                    NA
ocean_proximityNEAR_OCEAN:rcs(latitude, 4)latitude''     -567362.1936859
ocean_proximityINLAND:housing_median_age                     -82.1754728
ocean_proximityNEAR_BAY:housing_median_age                    96.8683668
ocean_proximityNEAR_OCEAN:housing_median_age                 592.0972227
ocean_proximityINLAND:total_rooms                             -1.4761759
ocean_proximityNEAR_BAY:total_rooms                           15.2769421
ocean_proximityNEAR_OCEAN:total_rooms                         12.1418385
ocean_proximityINLAND:total_bedrooms                          48.6847225
ocean_proximityNEAR_BAY:total_bedrooms                      -106.9013390
ocean_proximityNEAR_OCEAN:total_bedrooms                     110.0786118
ocean_proximityINLAND:population                              26.1814137
ocean_proximityNEAR_BAY:population                           -20.5255203
ocean_proximityNEAR_OCEAN:population                           7.7181825
ocean_proximityINLAND:households                            -131.9383004
ocean_proximityNEAR_BAY:households                            76.4576031
ocean_proximityNEAR_OCEAN:households                        -205.6808427</code></pre>
</div>
</div>
</section>
<section id="further-sampling" class="level1">
<h1>Further sampling</h1>
<p>In order to make the <code>test</code> dataset as if from a differnt sample/population, create two test sets, the cheaper houses and the more expensive houses. Also further sample 5% of each test sets for a easier visualization (calibration plot).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>test_cheap <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span> <span class="fu">filter</span>(median_house_value <span class="sc">&lt;=</span> <span class="fu">median</span>(test<span class="sc">$</span>median_house_value))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">31511</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(<span class="at">n =</span> <span class="fu">nrow</span>(test_cheap), <span class="at">size =</span> <span class="fu">floor</span>(.<span class="dv">05</span><span class="sc">*</span><span class="fu">nrow</span>(test_cheap)), <span class="at">replace =</span> F)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>test_cheap <span class="ot">&lt;-</span> test_cheap[sample, ]</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>test_expensive <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span> <span class="fu">filter</span>(median_house_value <span class="sc">&gt;</span> <span class="fu">median</span>(test<span class="sc">$</span>median_house_value))</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">31511</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(<span class="at">n =</span> <span class="fu">nrow</span>(test_expensive), <span class="at">size =</span> <span class="fu">floor</span>(.<span class="dv">05</span><span class="sc">*</span><span class="fu">nrow</span>(test_expensive)), <span class="at">replace =</span> F)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>test_expensive <span class="ot">&lt;-</span> test_expensive[sample, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  train <span class="sc">%&gt;%</span> <span class="fu">select</span>(longitude<span class="sc">:</span>ocean_proximity) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"train"</span>) ,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  test_cheap <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"test_cheap"</span>), </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  test_expensive <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"test_expensive"</span>))</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>type, <span class="at">levels=</span> <span class="fu">c</span>(<span class="st">"train"</span>, <span class="st">"test_cheap"</span>, <span class="st">"test_expensive"</span>))</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_summary</span>(<span class="at">by =</span> <span class="st">"type"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modify_header</span>(<span class="at">label =</span> <span class="st">"**Variable**"</span>) <span class="sc">%&gt;%</span> <span class="co"># update the column header</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modify_caption</span>(<span class="st">"Table 2. Summary of the three datasets"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bold_labels</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_flex_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-b0745d60{}.cl-b07185c2{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-b07185c3{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-b07185cc{font-family:'Helvetica';font-size:6.6pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;position: relative;bottom:3.3pt;}.cl-b072b122{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2pt;padding-top:2pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-b072b123{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2pt;padding-top:2pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-b072b12c{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-b072b12d{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-b072b12e{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:15pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-b072b12f{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-b072bd8e{width:1.746in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bd8f{width:2.171in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bd90{width:2.086in;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bd91{width:1.746in;background-color:transparent;vertical-align: top;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bd98{width:2.171in;background-color:transparent;vertical-align: top;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bd99{width:2.086in;background-color:transparent;vertical-align: top;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bd9a{width:1.746in;background-color:transparent;vertical-align: top;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bd9b{width:2.171in;background-color:transparent;vertical-align: top;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bd9c{width:2.086in;background-color:transparent;vertical-align: top;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bda2{width:1.746in;background-color:transparent;vertical-align: top;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bda3{width:2.171in;background-color:transparent;vertical-align: top;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bda4{width:2.086in;background-color:transparent;vertical-align: top;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bdac{width:1.746in;background-color:transparent;vertical-align: top;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bdad{width:2.171in;background-color:transparent;vertical-align: top;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bdae{width:2.086in;background-color:transparent;vertical-align: top;border-bottom: 1pt solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bdaf{width:1.746in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bdb6{width:2.171in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b072bdb7{width:2.086in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-b0745d60"><thead><tr style="overflow-wrap:break-word;"><th class="cl-b072bd8e"><p class="cl-b072b122"><span class="cl-b07185c2">Variable</span></p></th><th class="cl-b072bd8f"><p class="cl-b072b123"><span class="cl-b07185c2">train</span><span class="cl-b07185c3">  </span><br><span class="cl-b07185c3">N = 12,863</span><span class="cl-b07185cc">1</span></p></th><th class="cl-b072bd90"><p class="cl-b072b123"><span class="cl-b07185c2">test_cheap</span><span class="cl-b07185c3">  </span><br><span class="cl-b07185c3">N = 138</span><span class="cl-b07185cc">1</span></p></th><th class="cl-b072bd8f"><p class="cl-b072b123"><span class="cl-b07185c2">test_expensive</span><span class="cl-b07185c3">  </span><br><span class="cl-b07185c3">N = 137</span><span class="cl-b07185cc">1</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-b072bd91"><p class="cl-b072b12c"><span class="cl-b07185c2">longitude</span></p></td><td class="cl-b072bd98"><p class="cl-b072b12d"><span class="cl-b07185c3">-118.45 (-121.56, -117.97)</span></p></td><td class="cl-b072bd99"><p class="cl-b072b12d"><span class="cl-b07185c3">-119.42 (-121.66, -118.08)</span></p></td><td class="cl-b072bd98"><p class="cl-b072b12d"><span class="cl-b07185c3">-118.40 (-121.98, -117.95)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-b072bd9a"><p class="cl-b072b12c"><span class="cl-b07185c2">latitude</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">34.24 (33.92, 37.67)</span></p></td><td class="cl-b072bd9c"><p class="cl-b072b12d"><span class="cl-b07185c3">35.93 (33.95, 37.94)</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">34.17 (33.83, 37.32)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-b072bd91"><p class="cl-b072b12c"><span class="cl-b07185c2">housing_median_age</span></p></td><td class="cl-b072bd98"><p class="cl-b072b12d"><span class="cl-b07185c3">27 (17, 36)</span></p></td><td class="cl-b072bd99"><p class="cl-b072b12d"><span class="cl-b07185c3">29 (18, 36)</span></p></td><td class="cl-b072bd98"><p class="cl-b072b12d"><span class="cl-b07185c3">29 (20, 37)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-b072bd9a"><p class="cl-b072b12c"><span class="cl-b07185c2">total_rooms</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">2,155 (1,465, 3,184)</span></p></td><td class="cl-b072bd9c"><p class="cl-b072b12d"><span class="cl-b07185c3">1,796 (1,118, 2,784)</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">2,170 (1,722, 3,425)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-b072bd9a"><p class="cl-b072b12c"><span class="cl-b07185c2">total_bedrooms</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">443 (303, 659)</span></p></td><td class="cl-b072bd9c"><p class="cl-b072b12d"><span class="cl-b07185c3">388 (256, 605)</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">439 (313, 631)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-b072bd9a"><p class="cl-b072b12c"><span class="cl-b07185c2">population</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">1,203 (812, 1,782)</span></p></td><td class="cl-b072bd9c"><p class="cl-b072b12d"><span class="cl-b07185c3">1,069 (768, 1,832)</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">1,052 (851, 1,649)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-b072bd9a"><p class="cl-b072b12c"><span class="cl-b07185c2">households</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">417 (285, 615)</span></p></td><td class="cl-b072bd9c"><p class="cl-b072b12d"><span class="cl-b07185c3">365 (241, 580)</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">421 (303, 598)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-b072bd9a"><p class="cl-b072b12c"><span class="cl-b07185c2">median_income</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">3.49 (2.55, 4.63)</span></p></td><td class="cl-b072bd9c"><p class="cl-b072b12d"><span class="cl-b07185c3">2.61 (2.10, 3.27)</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">4.13 (3.51, 5.37)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-b072bd9a"><p class="cl-b072b12c"><span class="cl-b07185c2">median_house_value</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">171,900 (115,900, 244,200)</span></p></td><td class="cl-b072bd9c"><p class="cl-b072b12d"><span class="cl-b07185c3">112,600 (86,200, 148,500)</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">239,000 (198,500, 318,600)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-b072bda2"><p class="cl-b072b12c"><span class="cl-b07185c2">ocean_proximity</span></p></td><td class="cl-b072bda3"><p class="cl-b072b12d"><span class="cl-b07185c3"></span></p></td><td class="cl-b072bda4"><p class="cl-b072b12d"><span class="cl-b07185c3"></span></p></td><td class="cl-b072bda3"><p class="cl-b072b12d"><span class="cl-b07185c3"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-b072bd9a"><p class="cl-b072b12e"><span class="cl-b07185c3">&lt;1H_OCEAN</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">5,763 (45%)</span></p></td><td class="cl-b072bd9c"><p class="cl-b072b12d"><span class="cl-b07185c3">46 (33%)</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">82 (60%)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-b072bd9a"><p class="cl-b072b12e"><span class="cl-b07185c3">INLAND</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">4,390 (34%)</span></p></td><td class="cl-b072bd9c"><p class="cl-b072b12d"><span class="cl-b07185c3">69 (50%)</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">12 (8.8%)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-b072bd9a"><p class="cl-b072b12e"><span class="cl-b07185c3">NEAR_BAY</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">1,101 (8.6%)</span></p></td><td class="cl-b072bd9c"><p class="cl-b072b12d"><span class="cl-b07185c3">12 (8.7%)</span></p></td><td class="cl-b072bd9b"><p class="cl-b072b12d"><span class="cl-b07185c3">12 (8.8%)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-b072bdac"><p class="cl-b072b12e"><span class="cl-b07185c3">NEAR_OCEAN</span></p></td><td class="cl-b072bdad"><p class="cl-b072b12d"><span class="cl-b07185c3">1,609 (13%)</span></p></td><td class="cl-b072bdae"><p class="cl-b072b12d"><span class="cl-b07185c3">11 (8.0%)</span></p></td><td class="cl-b072bdad"><p class="cl-b072b12d"><span class="cl-b07185c3">31 (23%)</span></p></td></tr></tbody><tfoot><tr style="overflow-wrap:break-word;"><td colspan="4" class="cl-b072bdaf"><p class="cl-b072b12f"><span class="cl-b07185cc">1</span><span class="cl-b07185c3">Median (Q1, Q3); n (%)</span></p></td></tr></tfoot></table></div>
</div>
</div>
</section>
<section id="apply-the-models-on-the-cheaper-houses-test_cheap-dataset" class="level1">
<h1>Apply the models on the cheaper houses: <code>test_cheap</code> dataset</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocess the `test_cheap` dataset</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------- dummy variables --------</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>vars_cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>test_cheap <span class="ot">&lt;-</span> <span class="fu">step_dummy</span>(test_cheap, vars_cat)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># -------- rcs --------</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: using the knot locations in the `train` dataset</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>vars_rcs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>knots_list <span class="ot">&lt;-</span> <span class="fu">list</span>(knots_longitude_train, knots_latitude_train) <span class="co"># SEE HERE!!</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>knots_list <span class="ot">&lt;-</span> <span class="fu">setNames</span>(knots_list, vars_rcs)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>test_cheap <span class="ot">&lt;-</span> <span class="fu">step_rcs</span>(test_cheap, vars_rcs, knots_list)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co"># -------- interaction terms --------</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>interaction_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"longitude"</span>),</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"housing_median_age"</span>),</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"total_rooms"</span>),</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"total_bedrooms"</span>),</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"population"</span>),</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"households"</span>)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>test_cheap <span class="ot">&lt;-</span> <span class="fu">step_interaction</span>(test_cheap, interaction_list)</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="co"># -------- centering --------</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>vars_mean <span class="ot">&lt;-</span> <span class="fu">names</span>(test_cheap)</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. centering using the mean values in the `train` dataset</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>test_cheap_means_train <span class="ot">&lt;-</span> <span class="fu">step_center</span>(test_cheap, vars_center, means_train)</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. centering using the mean values in the `test_cheap` dataset</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="co"># get mean values</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>means_test_cheap <span class="ot">&lt;-</span> <span class="fu">get_mean</span>(test_cheap, vars_mean)</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a><span class="co"># centering vars in the test_cheap dataset</span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>vars_center <span class="ot">&lt;-</span> <span class="fu">names</span>(means_test_cheap)</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>test_cheap_means_test_cheap <span class="ot">&lt;-</span> <span class="fu">step_center</span>(test_cheap, vars_center, means_test_cheap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The original model on the test_cheap dataset</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>test_cheap_means_train<span class="sc">$</span>pred.o <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.o, <span class="at">newdata =</span> test_cheap_means_train)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The centered model on the test_cheap dataset, using the mean values in the train dataset</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>test_cheap_means_train<span class="sc">$</span>pred.c <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.c, <span class="at">newdata =</span> test_cheap_means_train)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The centered model on the test_cheap dataset, using the mean values in the test_cheap dataset</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: need to manually changing the intercept to the new outconme mean</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"Mean outcome in the dataset: "</span>, <span class="fu">mean</span>(test_cheap_means_test_cheap<span class="sc">$</span>median_house_value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mean outcome in the dataset: 115102.898550725"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>fit.c<span class="fl">.2</span> <span class="ot">&lt;-</span> fit.c</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>fit.c<span class="fl">.2</span><span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(test_cheap_means_test_cheap<span class="sc">$</span>median_house_value)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>test_cheap_means_test_cheap<span class="sc">$</span>pred.c <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.c<span class="fl">.2</span>, <span class="at">newdata =</span> test_cheap_means_test_cheap)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># To confirm that column 2 and 3 below are identical</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">cbind</span>(test_cheap_means_train<span class="sc">$</span>median_house_value, test_cheap_means_train<span class="sc">$</span>pred.o, </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>test_cheap_means_train<span class="sc">$</span>pred.c, test_cheap_means_test_cheap<span class="sc">$</span>pred.c))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       [,1]      [,2]      [,3]      [,4]
[1,] 145200 129397.46 129397.46 111290.40
[2,] 148200 140242.06 140242.06 122135.00
[3,]  73800 101046.11 101046.11  82939.06
[4,]  75000 172280.43 172280.43 154173.37
[5,] 164000  82143.28  82143.28  64036.22
[6,] 162000 170750.24 170750.24 152643.18</code></pre>
</div>
</div>
<section id="some-calibration-plots-on-the-test_cheap-dataset" class="level2">
<h2 class="anchored" data-anchor-id="some-calibration-plots-on-the-test_cheap-dataset">Some calibration plots on the test_cheap dataset</h2>
<p>Since <code>train</code> and <code>test_cheap</code> datasets are from the same population, recalibration doesnt have a strong effect.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- Overall calibration ----------</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The original model </span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">calibration</span>(test_cheap_means_train<span class="sc">$</span>pred.o, test_cheap_means_train<span class="sc">$</span>median_house_value, <span class="at">labelPos.x =</span> <span class="dv">30000</span>, <span class="at">labelPos.y =</span> <span class="dv">220000</span>, <span class="at">marginPlt =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1.5-real_data_example_linear_regression_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  group Intercept     Slope     Emax      E90     Eavg
1        49220.73 0.4945739 104006.9 69073.37 30415.99</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The centered model with the original means </span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># It is confirm that this is the same as using the original model. Will be ommitted below.</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">calibration</span>(test_cheap_means_train<span class="sc">$</span>pred.c, test_cheap_means_train<span class="sc">$</span>median_house_value, <span class="at">labelPos.x =</span> <span class="dv">30000</span>, <span class="at">labelPos.y =</span> <span class="dv">220000</span>, <span class="at">marginPlt =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1.5-real_data_example_linear_regression_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  group Intercept     Slope     Emax      E90     Eavg
1        49220.73 0.4945739 104006.9 69073.37 30415.99</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The centered model with the updated means</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">calibration</span>(test_cheap_means_test_cheap<span class="sc">$</span>pred.c, test_cheap_means_test_cheap<span class="sc">$</span>median_house_value, <span class="at">labelPos.x =</span> <span class="dv">30000</span>, <span class="at">labelPos.y =</span> <span class="dv">220000</span>, <span class="at">marginPlt =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1.5-real_data_example_linear_regression_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  group Intercept     Slope     Emax      E90    Eavg
1        58176.01 0.4945739 99963.78 59737.98 26983.4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- Calibration on ocean_proximity ----------</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The original model </span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">calibration</span>(test_cheap_means_train<span class="sc">$</span>pred.o, test_cheap_means_train<span class="sc">$</span>median_house_value, <span class="at">group =</span> test_cheap_means_train<span class="sc">$</span>ocean_proximity, <span class="at">labelPos.x =</span> <span class="dv">30000</span>, <span class="at">labelPos.y =</span> <span class="dv">220000</span>, <span class="at">marginPlt =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1.5-real_data_example_linear_regression_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       group        Intercept             Slope             Emax
1            49220.7277873034 0.494573922613971  104006.88901982
2  &lt;1H_OCEAN 74217.3626534643 0.366615086307092 97726.8227205036
3     INLAND 40230.1533037862 0.536726525022307 94973.4679338615
4   NEAR_BAY 115217.460932162 0.163585516884874 78892.2311431508
5 NEAR_OCEAN 78863.1815357313 0.300481782080869  104006.88901982
               E90             Eavg
1 69073.3735514908 30415.9919905195
2 74107.2749995844 37237.2804259024
3  48858.935485975 23130.5346686188
4 59865.7484572527 28575.0686998696
5 103628.120953743 49598.5707788225</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The original model with the updated means</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">calibration</span>(test_cheap_means_test_cheap<span class="sc">$</span>pred.c, test_cheap_means_test_cheap<span class="sc">$</span>median_house_value, <span class="at">group =</span> test_cheap_means_test_cheap<span class="sc">$</span>ocean_proximity, <span class="at">labelPos.x =</span> <span class="dv">30000</span>, <span class="at">labelPos.y =</span> <span class="dv">220000</span>, <span class="at">marginPlt =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1.5-real_data_example_linear_regression_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       group        Intercept             Slope             Emax
1            58176.0065105024 0.494573922611842 99963.7829211572
2  &lt;1H_OCEAN 80855.6833007541 0.366615086305333  92270.400187191
3     INLAND 49948.6916451379  0.53672652502257 99963.7829211572
4   NEAR_BAY 118179.513381607  0.16358551688283 60785.1731015507
5 NEAR_OCEAN 84304.0226040116 0.300481782081245 85899.8309789057
               E90             Eavg
1  59737.982561281 26983.4039897797
2 65934.6940314728 31892.3709881853
3 51070.9884681703 22061.7535666442
4  41758.690414637 29151.4044641467
5 85521.0629129042 34962.0759513512</code></pre>
</div>
</div>
</section>
</section>
<section id="apply-the-models-on-the-more-expensive-houses-test_expensive-dataset" class="level1">
<h1>Apply the models on the more expensive houses: <code>test_expensive</code> dataset</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocess the `test_expensive` dataset</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------- dummy variables --------</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>vars_cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>test_expensive <span class="ot">&lt;-</span> <span class="fu">step_dummy</span>(test_expensive, vars_cat)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co"># -------- rcs --------</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: using the knot locations in the `train` dataset</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>vars_rcs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>knots_list <span class="ot">&lt;-</span> <span class="fu">list</span>(knots_longitude_train, knots_latitude_train) <span class="co"># SEE HERE!!</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>knots_list <span class="ot">&lt;-</span> <span class="fu">setNames</span>(knots_list, vars_rcs)</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>test_expensive <span class="ot">&lt;-</span> <span class="fu">step_rcs</span>(test_expensive, vars_rcs, knots_list)</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="co"># -------- interaction terms --------</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>interaction_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"longitude"</span>),</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"housing_median_age"</span>),</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"total_rooms"</span>),</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"total_bedrooms"</span>),</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"population"</span>),</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"ocean_proximity"</span>, <span class="st">"households"</span>)</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>test_expensive <span class="ot">&lt;-</span> <span class="fu">step_interaction</span>(test_expensive, interaction_list)</span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a><span class="co"># -------- centering --------</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>vars_mean <span class="ot">&lt;-</span> <span class="fu">names</span>(test_expensive)</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. centering using the mean values in the `train` dataset</span></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>test_expensive_means_train <span class="ot">&lt;-</span> <span class="fu">step_center</span>(test_expensive, vars_center, means_train)</span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. centering using the mean values in the `test_expensive` dataset</span></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a><span class="co"># get mean values</span></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>means_test_expensive <span class="ot">&lt;-</span> <span class="fu">get_mean</span>(test_expensive, vars_mean)</span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a><span class="co"># centering vars in the test_expensive dataset</span></span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a>vars_center <span class="ot">&lt;-</span> <span class="fu">names</span>(means_test_expensive)</span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>test_expensive_means_test_expensive <span class="ot">&lt;-</span> <span class="fu">step_center</span>(test_expensive, vars_center, means_test_expensive)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The original model on the test_expensive dataset</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>test_expensive_means_train<span class="sc">$</span>pred.o <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.o, <span class="at">newdata =</span> test_expensive_means_train)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The centered model on the test_expensive dataset, using the mean values in the train dataset</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>test_expensive_means_train<span class="sc">$</span>pred.c <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.c, <span class="at">newdata =</span> test_expensive_means_train)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The centered model on the test_expensive dataset, using the mean values in the test_expensive dataset</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: need to manually changing the intercept to the new outconme mean</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"Mean outcome in the dataset: "</span>, <span class="fu">mean</span>(test_expensive_means_test_expensive<span class="sc">$</span>median_house_value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mean outcome in the dataset: 267826.277372263"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>fit.c<span class="fl">.2</span> <span class="ot">&lt;-</span> fit.c</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>fit.c<span class="fl">.2</span><span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(test_expensive_means_test_expensive<span class="sc">$</span>median_house_value)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>test_expensive_means_test_expensive<span class="sc">$</span>pred.c <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit.c<span class="fl">.2</span>, <span class="at">newdata =</span> test_expensive_means_test_expensive)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># To confirm that column 2 and 3 below are identical</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">cbind</span>(test_expensive_means_train<span class="sc">$</span>median_house_value, test_expensive_means_train<span class="sc">$</span>pred.o, </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>test_expensive_means_train<span class="sc">$</span>pred.c, test_expensive_means_test_expensive<span class="sc">$</span>pred.c))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       [,1]     [,2]     [,3]     [,4]
[1,] 273800 238948.4 238948.4 257949.8
[2,] 185900 257779.4 257779.4 276780.7
[3,] 193800 241635.9 241635.9 260637.3
[4,] 350000 205356.9 205356.9 224358.2
[5,] 281300 255948.2 255948.2 274949.5
[6,] 396300 247880.2 247880.2 266881.5</code></pre>
</div>
</div>
<section id="some-calibration-plots-on-the-test_expensive-dataset" class="level2">
<h2 class="anchored" data-anchor-id="some-calibration-plots-on-the-test_expensive-dataset">Some calibration plots on the test_expensive dataset</h2>
<p>Since <code>train</code> and <code>test_expensive</code> datasets are from the same population, recalibration doesnt have a strong effect.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- Overall calibration ----------</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The original model </span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">calibration</span>(test_expensive_means_train<span class="sc">$</span>pred.o, test_expensive_means_train<span class="sc">$</span>median_house_value, <span class="at">labelPos.x =</span> <span class="dv">200000</span>, <span class="at">labelPos.y =</span> <span class="dv">450000</span>, <span class="at">marginPlt =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1.5-real_data_example_linear_regression_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  group Intercept     Slope     Emax      E90     Eavg
1        38392.09 0.9220708 295925.9 108442.1 49144.01</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The centered model with the updated means</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">calibration</span>(test_expensive_means_test_expensive<span class="sc">$</span>pred.c, test_expensive_means_test_expensive<span class="sc">$</span>median_house_value, <span class="at">labelPos.x =</span> <span class="dv">200000</span>, <span class="at">labelPos.y =</span> <span class="dv">450000</span>, <span class="at">marginPlt =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1.5-real_data_example_linear_regression_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  group Intercept     Slope     Emax      E90     Eavg
1        20871.49 0.9220708 276924.5 100851.5 51205.05</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- Calibration on ocean_proximity ----------</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The original model </span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">calibration</span>(test_expensive_means_train<span class="sc">$</span>pred.o, test_expensive_means_train<span class="sc">$</span>median_house_value, <span class="at">group =</span> test_expensive_means_train<span class="sc">$</span>ocean_proximity, <span class="at">labelPos.x =</span> <span class="dv">200000</span>, <span class="at">labelPos.y =</span> <span class="dv">450000</span>, <span class="at">marginPlt =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1.5-real_data_example_linear_regression_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       group         Intercept             Slope             Emax
1               38392.08566726 0.922070803277315 295925.869616176
2  &lt;1H_OCEAN  31410.9435649187 0.935589238923206  233362.09372422
3     INLAND  89808.0620886236 0.746073106243099 101775.059769638
4   NEAR_BAY -37057.0125514169  1.17699057545676 104059.762373125
5 NEAR_OCEAN  102580.345404111 0.727047907376554 295925.869616176
               E90             Eavg
1  108442.05556676  49144.007395252
2 93995.0976912768 42125.5615448095
3 91287.7039386755 51823.4658651938
4 67288.1363245943 35160.7771253753
5 140679.599092369 72084.5822770423</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The original model with the updated means</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">calibration</span>(test_expensive_means_test_expensive<span class="sc">$</span>pred.c, test_expensive_means_test_expensive<span class="sc">$</span>median_house_value, <span class="at">group =</span> test_expensive_means_test_expensive<span class="sc">$</span>ocean_proximity, <span class="at">labelPos.x =</span> <span class="dv">200000</span>, <span class="at">labelPos.y =</span> <span class="dv">450000</span>, <span class="at">marginPlt =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="1.5-real_data_example_linear_regression_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       group         Intercept             Slope             Emax
1             20871.4866573836 0.922070803275326 276924.509905576
2  &lt;1H_OCEAN  13633.4758965017 0.935589238923128 214360.734015451
3     INLAND   75631.658627661 0.746073106242951 88668.6082123927
4   NEAR_BAY -59421.4338497942  1.17699057545825 88241.5821480429
5 NEAR_OCEAN  88765.4465894019 0.727047907376148 276924.509905576
               E90             Eavg
1 100851.548932597 51205.0522420385
2  84338.182419569 45582.9975964682
3 81858.5630240534  43220.241184442
4 81656.8575022057 38327.6704103114
5 121678.239381761 74151.9811326402</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>